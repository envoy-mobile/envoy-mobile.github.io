<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DXJEH1ZRXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DXJEH1ZRXX');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Starting Envoy &mdash; envoy-mobile 0.5.0-b6fba8 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../_static/css/envoy.css?v=98e714dc" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=9335e20e"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTP requests and streams" href="http.html" />
    <link rel="prev" title="API" href="api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            envoy-mobile
          </a>
              <div class="version">
                0.5.0-b6fba8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../start/start.html">Getting Started</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="api.html">API</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Starting Envoy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#streamclient"><code class="docutils literal notranslate"><span class="pre">StreamClient</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enginebuilder"><code class="docutils literal notranslate"><span class="pre">EngineBuilder</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-configuration">Advanced configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#making-requests">Making requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="http.html">HTTP requests and streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc.html">gRPC streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="stats.html">Pulse (Stats)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../start/building/building.html">Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/examples/hello_world.html">Hello World</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Starting Envoy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#streamclient"><code class="docutils literal notranslate"><span class="pre">StreamClient</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#enginebuilder"><code class="docutils literal notranslate"><span class="pre">EngineBuilder</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#addconnecttimeoutseconds"><code class="docutils literal notranslate"><span class="pre">addConnectTimeoutSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#adddnsfailurerefreshseconds"><code class="docutils literal notranslate"><span class="pre">addDNSFailureRefreshSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#adddnsrefreshseconds"><code class="docutils literal notranslate"><span class="pre">addDNSRefreshSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#adddnsquerytimeoutseconds"><code class="docutils literal notranslate"><span class="pre">addDNSQueryTimeoutSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#adddnspreresolvehostnames"><code class="docutils literal notranslate"><span class="pre">addDNSPreresolveHostnames</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addloglevel"><code class="docutils literal notranslate"><span class="pre">addLogLevel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addgrpcstatsdomain"><code class="docutils literal notranslate"><span class="pre">addGrpcStatsDomain</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addstatsflushseconds"><code class="docutils literal notranslate"><span class="pre">addStatsFlushSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addstreamidletimeoutseconds"><code class="docutils literal notranslate"><span class="pre">addStreamIdleTimeoutSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addpertryidletimeoutseconds"><code class="docutils literal notranslate"><span class="pre">addPerTryIdleTimeoutSeconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addappversion"><code class="docutils literal notranslate"><span class="pre">addAppVersion</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addappid"><code class="docutils literal notranslate"><span class="pre">addAppId</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addnativefilter"><code class="docutils literal notranslate"><span class="pre">addNativeFilter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setonenginerunning"><code class="docutils literal notranslate"><span class="pre">setOnEngineRunning</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setlogger"><code class="docutils literal notranslate"><span class="pre">setLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#seteventtracker"><code class="docutils literal notranslate"><span class="pre">setEventTracker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addstringaccessor"><code class="docutils literal notranslate"><span class="pre">addStringAccessor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setnetworkmonitoringmode"><code class="docutils literal notranslate"><span class="pre">setNetworkMonitoringMode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enablegzipdecompression"><code class="docutils literal notranslate"><span class="pre">enableGzipDecompression</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enablebrotlidecompression"><code class="docutils literal notranslate"><span class="pre">enableBrotliDecompression</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enablehttp3"><code class="docutils literal notranslate"><span class="pre">enableHttp3</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addquichint"><code class="docutils literal notranslate"><span class="pre">addQuicHint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enablesockettagging"><code class="docutils literal notranslate"><span class="pre">enableSocketTagging</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enableinterfacebinding"><code class="docutils literal notranslate"><span class="pre">enableInterfaceBinding</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#addkeyvaluestore"><code class="docutils literal notranslate"><span class="pre">addKeyValueStore</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#forceipv6"><code class="docutils literal notranslate"><span class="pre">forceIPv6</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enableplatformcertificatesvalidation"><code class="docutils literal notranslate"><span class="pre">enablePlatformCertificatesValidation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enableproxying"><code class="docutils literal notranslate"><span class="pre">enableProxying</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#enablednscache"><code class="docutils literal notranslate"><span class="pre">enableDNSCache</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setruntimeguard"><code class="docutils literal notranslate"><span class="pre">setRuntimeGuard</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setxds"><code class="docutils literal notranslate"><span class="pre">setXds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setnodeid"><code class="docutils literal notranslate"><span class="pre">setNodeId</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#setnodelocality"><code class="docutils literal notranslate"><span class="pre">setNodeLocality</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-configuration">Advanced configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-requests">Making requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="http.html">HTTP requests and streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="grpc.html">gRPC streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats.html">Pulse (Stats)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/development.html">Development</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">envoy-mobile</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../start/start.html">Getting Started</a></li>
          <li class="breadcrumb-item"><a href="api.html">API</a></li>
      <li class="breadcrumb-item active">Starting Envoy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/starting_envoy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="starting-envoy">
<span id="api-starting-envoy"></span><h1>Starting Envoy<a class="headerlink" href="#starting-envoy" title="Link to this heading">¶</a></h1>
<section id="streamclient">
<h2><code class="docutils literal notranslate"><span class="pre">StreamClient</span></code><a class="headerlink" href="#streamclient" title="Link to this heading">¶</a></h2>
<p>Starting an instance of Envoy Mobile is done by building the <code class="docutils literal notranslate"><span class="pre">Engine</span></code> instance with <code class="docutils literal notranslate"><span class="pre">EngineBuilder</span></code>. Requests are performed by the <code class="docutils literal notranslate"><span class="pre">StreamClient</span></code> provided by <code class="docutils literal notranslate"><span class="pre">Engine</span></code>.</p>
<p>To obtain a <code class="docutils literal notranslate"><span class="pre">StreamClient</span></code>, call <code class="docutils literal notranslate"><span class="pre">streamClient()</span></code> on the <code class="docutils literal notranslate"><span class="pre">Engine</span></code> instance (see below).</p>
<p>After the stream client is obtained, it should be stored and used to start network requests/streams.</p>
<p><strong>Kotlin example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">streamClient</span> <span class="o">=</span> <span class="n">AndroidEngineBuilder</span><span class="p">(</span><span class="n">getApplication</span><span class="p">())</span>
  <span class="o">.</span><span class="n">addLogLevel</span><span class="p">(</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">WARN</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="o">.</span><span class="n">build</span><span class="p">()</span>
  <span class="o">.</span><span class="n">streamClient</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Swift example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">streamClient</span> <span class="o">=</span> <span class="k">try</span> <span class="n">EngineBuilder</span><span class="p">()</span>
  <span class="o">.</span><span class="n">addLogLevel</span><span class="p">(</span><span class="o">.</span><span class="n">warn</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="o">.</span><span class="n">build</span><span class="p">()</span>
  <span class="o">.</span><span class="n">streamClient</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="enginebuilder">
<h2><code class="docutils literal notranslate"><span class="pre">EngineBuilder</span></code><a class="headerlink" href="#enginebuilder" title="Link to this heading">¶</a></h2>
<p>This type is used to configure an instance of <code class="docutils literal notranslate"><span class="pre">Engine</span></code> before finally
creating the engine using <code class="docutils literal notranslate"><span class="pre">.build()</span></code>.</p>
<p>Available builders are nearly all 1:1 between iOS/Android, and are documented below.</p>
<section id="addconnecttimeoutseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addConnectTimeoutSeconds</span></code><a class="headerlink" href="#addconnecttimeoutseconds" title="Link to this heading">¶</a></h3>
<p>Specify the timeout for new network connections to hosts in Envoy Mobile clusters.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addConnectTimeoutSeconds</span><span class="p">(</span><span class="mi">30</span><span class="n">L</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addConnectTimeoutSeconds</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adddnsfailurerefreshseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addDNSFailureRefreshSeconds</span></code><a class="headerlink" href="#adddnsfailurerefreshseconds" title="Link to this heading">¶</a></h3>
<p>Specify the rate at which Envoy Mobile should refresh DNS in states of failure.</p>
<p>This should typically be a relatively aggressive range compared to the standard-state DNS refresh
rate, as it is required for Envoy Mobile to recover and continue making requests.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addDNSFailureRefreshSeconds</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addDNSFailureRefreshSeconds</span><span class="p">(</span><span class="n">base</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adddnsrefreshseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addDNSRefreshSeconds</span></code><a class="headerlink" href="#adddnsrefreshseconds" title="Link to this heading">¶</a></h3>
<p>Specify the interval at which Envoy should forcefully refresh DNS.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addDNSRefreshSeconds</span><span class="p">(</span><span class="mi">60</span><span class="n">L</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addDNSRefreshSeconds</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adddnsquerytimeoutseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addDNSQueryTimeoutSeconds</span></code><a class="headerlink" href="#adddnsquerytimeoutseconds" title="Link to this heading">¶</a></h3>
<p>Specify the interval at which Envoy should timeout a DNS query.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addDNSQueryTimeoutSeconds</span><span class="p">(</span><span class="mi">60</span><span class="n">L</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addDNSQueryTimeoutSeconds</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="adddnspreresolvehostnames">
<h3><code class="docutils literal notranslate"><span class="pre">addDNSPreresolveHostnames</span></code><a class="headerlink" href="#adddnspreresolvehostnames" title="Link to this heading">¶</a></h3>
<p>Add a list of hostnames to preresolve on Engine startup.</p>
<blockquote>
<div><p>// Kotlin
builder.addDNSPreresolveHostnames(listOf(“lyft.com”, “google.com”))</p>
<p>// Swift
builder.addDNSPreresolveHostnames([“lyft.com”, “google.com”])</p>
</div></blockquote>
</section>
<section id="addloglevel">
<h3><code class="docutils literal notranslate"><span class="pre">addLogLevel</span></code><a class="headerlink" href="#addloglevel" title="Link to this heading">¶</a></h3>
<p>Specify the log level to be used when running the underlying Envoy engine.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addLogLevel</span><span class="p">(</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">WARN</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addLogLevel</span><span class="p">(</span><span class="o">.</span><span class="n">warn</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addgrpcstatsdomain">
<h3><code class="docutils literal notranslate"><span class="pre">addGrpcStatsDomain</span></code><a class="headerlink" href="#addgrpcstatsdomain" title="Link to this heading">¶</a></h3>
<p>Specify a domain which implements the
<a class="reference external" href="https://github.com/envoyproxy/envoy-mobile/tree/83908423d46a37574e9a35627df1f3dd9634e5ec/library/common/config_template.cc#L139-L145">stats endpoint</a>
in order to take advantage of the
<a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cluster_stats">stats emitted by Envoy</a>
(and subsequently Envoy Mobile).</p>
<p>Note that only stats specified in the configuration’s
<a class="reference external" href="https://github.com/envoyproxy/envoy-mobile/tree/83908423d46a37574e9a35627df1f3dd9634e5ec/library/common/config_template.cc#L146-L167">inclusion list</a>
will be emitted.</p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">nil</span></code>/<code class="docutils literal notranslate"><span class="pre">null</span></code> disables stats emission, and this is the default value.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addGrpcStatsDomain</span><span class="p">(</span><span class="s2">&quot;envoy-mobile.envoyproxy.io&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addGrpcStatsDomain</span><span class="p">(</span><span class="s2">&quot;envoy-mobile.envoyproxy.io&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addstatsflushseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addStatsFlushSeconds</span></code><a class="headerlink" href="#addstatsflushseconds" title="Link to this heading">¶</a></h3>
<p>Specify the rate at which Envoy Mobile should flush its queued stats.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addStatsFlushSeconds</span><span class="p">(</span><span class="mi">5</span><span class="n">L</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addStatsFlushSeconds</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addstreamidletimeoutseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addStreamIdleTimeoutSeconds</span></code><a class="headerlink" href="#addstreamidletimeoutseconds" title="Link to this heading">¶</a></h3>
<p>Specifies the length of time a stream should wait without a headers or data event before timing out.
Defaults to 15 seconds.
See <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-stream-idle-timeout">the Envoy docs</a>
for further information.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addStreamIdleTimeoutSeconds</span><span class="p">(</span><span class="mi">5</span><span class="n">L</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addStreamIdleTimeoutSeconds</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addpertryidletimeoutseconds">
<h3><code class="docutils literal notranslate"><span class="pre">addPerTryIdleTimeoutSeconds</span></code><a class="headerlink" href="#addpertryidletimeoutseconds" title="Link to this heading">¶</a></h3>
<p>Specifies the length of time a retry (including the initial attempt) should wait without a headers
or data event before timing out. Defaults to 15 seconds.
See <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/route/v3/route_components.proto.html#config-route-v3-retrypolicy">the Envoy docs</a>
for further information.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addPerTryIdleTimeoutSeconds</span><span class="p">(</span><span class="mi">5</span><span class="n">L</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addPerTryIdleTimeoutSeconds</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addappversion">
<h3><code class="docutils literal notranslate"><span class="pre">addAppVersion</span></code><a class="headerlink" href="#addappversion" title="Link to this heading">¶</a></h3>
<p>Specify the version of the app using Envoy Mobile.
This information is sent as metadata when flushing stats.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addAppVersion</span><span class="p">(</span><span class="s2">&quot;v1.2.3&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addAppVersion</span><span class="p">(</span><span class="s2">&quot;v1.2.3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addappid">
<h3><code class="docutils literal notranslate"><span class="pre">addAppId</span></code><a class="headerlink" href="#addappid" title="Link to this heading">¶</a></h3>
<p>Specify the version of the app using Envoy Mobile.
This information is sent as metadata when flushing stats.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addAppId</span><span class="p">(</span><span class="s2">&quot;com.mydomain.myapp&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addAppId</span><span class="p">(</span><span class="s2">&quot;com.mydomain.myapp)</span>
</pre></div>
</div>
</section>
<section id="addnativefilter">
<h3><code class="docutils literal notranslate"><span class="pre">addNativeFilter</span></code><a class="headerlink" href="#addnativefilter" title="Link to this heading">¶</a></h3>
<p>Add a C++ filter to the Envoy Mobile filter chain</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>This will only work if the C++ filter specified is linked into your Envoy Mobile build.
For C++ and Android testing, calling addNativeFilter and linking the Envoy library by adding the
library to <code class="docutils literal notranslate"><span class="pre">envoy_build_config/extensions_build_config.bzl</span></code> is sufficient.
For iOS, due to enthusiastic garbage collection, and for upstream CI, to catch bugs, you will
also need to forceRegister the filter in <code class="docutils literal notranslate"><span class="pre">envoy_build_config/extension_registry.cc</span></code></p>
</div>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addNativeFilter</span><span class="p">(</span><span class="s2">&quot;envoy.filters.http.buffer&quot;</span><span class="p">,</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">@type</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">type.googleapis.com/envoy.extensions.filters.http.buffer.v3.Buffer</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">max_request_bytes</span><span class="se">\&quot;</span><span class="s2">:5242880}&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addNativeFilter</span><span class="p">(</span><span class="s2">&quot;envoy.filters.http.buffer&quot;</span><span class="p">,</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">@type</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">type.googleapis.com/envoy.extensions.filters.http.buffer.v3.Buffer</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">max_request_bytes</span><span class="se">\&quot;</span><span class="s2">:5242880}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setonenginerunning">
<h3><code class="docutils literal notranslate"><span class="pre">setOnEngineRunning</span></code><a class="headerlink" href="#setonenginerunning" title="Link to this heading">¶</a></h3>
<p>Specify a closure to be called once Envoy’s engine finishes its async startup and begins running.</p>
<p>When Envoy is instantiated, its initializer returns before all of its internal configuration
completes. This interface provides the ability to observe when Envoy has completed its setup and is
ready to start dispatching requests. Any requests sent through Envoy before this setup completes
will be queued automatically, and this function is typically used purely for observability.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setOnEngineRunning</span> <span class="p">{</span> <span class="o">/*</span><span class="n">do</span> <span class="n">something</span><span class="o">*/</span> <span class="p">}</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setOnEngineRunning</span> <span class="p">{</span> <span class="o">/*</span><span class="n">do</span> <span class="n">something</span><span class="o">*/</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="setlogger">
<h3><code class="docutils literal notranslate"><span class="pre">setLogger</span></code><a class="headerlink" href="#setlogger" title="Link to this heading">¶</a></h3>
<p>Specify a closure to be called when Envoy’s engine emits a log message.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="o">//</span> <span class="n">This</span> <span class="n">interface</span> <span class="ow">is</span> <span class="n">pending</span> <span class="k">for</span> <span class="n">Kotlin</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setLogger</span> <span class="p">{</span> <span class="n">msg</span> <span class="ow">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s2">&quot;Envoy log: \(msg)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="seteventtracker">
<h3><code class="docutils literal notranslate"><span class="pre">setEventTracker</span></code><a class="headerlink" href="#seteventtracker" title="Link to this heading">¶</a></h3>
<p>Specify a closure to be called when Envoy’s engine emits an event.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setEventTracker</span> <span class="p">({</span>
  <span class="o">//</span> <span class="n">Track</span> <span class="n">the</span> <span class="n">events</span><span class="o">.</span> <span class="n">Events</span> <span class="n">are</span> <span class="n">passed</span> <span class="ow">in</span> <span class="k">as</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;.</span>
<span class="p">})</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setEventTracker</span> <span class="p">{</span> <span class="n">event</span> <span class="ow">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s2">&quot;Envoy log: \(event)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="addstringaccessor">
<h3><code class="docutils literal notranslate"><span class="pre">addStringAccessor</span></code><a class="headerlink" href="#addstringaccessor" title="Link to this heading">¶</a></h3>
<p>Specify a closure to be called by Envoy to access arbitrary strings from Platform runtime.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addStringAccessor</span><span class="p">(</span><span class="s2">&quot;demo-accessor&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;PlatformString&quot;</span> <span class="p">})</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addStringAccessor</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;demo-accessor&quot;</span><span class="p">,</span> <span class="n">accessor</span><span class="p">:</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">&quot;PlatformString&quot;</span> <span class="p">})</span>
</pre></div>
</div>
</section>
<section id="setnetworkmonitoringmode">
<h3><code class="docutils literal notranslate"><span class="pre">setNetworkMonitoringMode</span></code><a class="headerlink" href="#setnetworkmonitoringmode" title="Link to this heading">¶</a></h3>
<p>Configure how the engine observes network reachability state changes to update the preferred Envoy network cluster (e.g. WLAN vs WWAN).
Defaults to <code class="docutils literal notranslate"><span class="pre">NWPathMonitor</span></code>, but can be configured to use <code class="docutils literal notranslate"><span class="pre">SCNetworkReachability</span></code> or be disabled completely.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="o">//</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNetworkMonitoringMode</span><span class="p">(</span><span class="o">.</span><span class="n">pathMonitor</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enablegzipdecompression">
<h3><code class="docutils literal notranslate"><span class="pre">enableGzipDecompression</span></code><a class="headerlink" href="#enablegzipdecompression" title="Link to this heading">¶</a></h3>
<p>Specify whether to enable transparent response Gzip decompression. Defaults to true.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableGzipDecompression</span><span class="p">(</span><span class="n">false</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableGzipDecompression</span><span class="p">(</span><span class="n">false</span><span class="p">)</span>
</pre></div>
</div>
<p>Default values from the <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/compression/gzip/decompressor/v3/gzip.proto">gzip decompressor proto</a>
are used.</p>
</section>
<section id="enablebrotlidecompression">
<h3><code class="docutils literal notranslate"><span class="pre">enableBrotliDecompression</span></code><a class="headerlink" href="#enablebrotlidecompression" title="Link to this heading">¶</a></h3>
<p>Specify whether to enable transparent response Brotli decompression. Defaults to false.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableBrotliDecompression</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableBrotliDecompression</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
<p>Default values from the <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/compression/brotli/decompressor/v3/brotli.proto">brotli decompressor proto</a>
are used.</p>
</section>
<section id="enablehttp3">
<h3><code class="docutils literal notranslate"><span class="pre">enableHttp3</span></code><a class="headerlink" href="#enablehttp3" title="Link to this heading">¶</a></h3>
<p>Specify whether to enable HTTP/3. Defaults to true. Only available when the Envoy Mobile build has HTTP/3 included.
When HTTP/3 is enabled, the client will first talk HTTP/2 with the servers and upon receiving alt-svc in the response,
following traffic will be sent via HTTP/3.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableHttp3</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableHttp3</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addquichint">
<h3><code class="docutils literal notranslate"><span class="pre">addQuicHint</span></code><a class="headerlink" href="#addquichint" title="Link to this heading">¶</a></h3>
<p>Add a host port pair that’s known to support QUIC. Only available when HTTP/3 is enabled.
It can be called multiple times to append a list of QUIC hints.
This allows HTTP/3 to be used for the first request to the hosts and avoid the HTTP/2 -&gt; HTTP/3 switch as mentioned in enableHttp3.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addQuicHint</span><span class="p">(</span><span class="s2">&quot;www.example.com&quot;</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addQuicHint</span><span class="p">(</span><span class="s2">&quot;www.example.com&quot;</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enablesockettagging">
<h3><code class="docutils literal notranslate"><span class="pre">enableSocketTagging</span></code><a class="headerlink" href="#enablesockettagging" title="Link to this heading">¶</a></h3>
<p>Specify whether to enable support for Android socket tagging. Unavailable on iOS. Defaults to false.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableSocketTagging</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enableinterfacebinding">
<h3><code class="docutils literal notranslate"><span class="pre">enableInterfaceBinding</span></code><a class="headerlink" href="#enableinterfacebinding" title="Link to this heading">¶</a></h3>
<p>Specify whether sockets may attempt to bind to a specific interface, based on network conditions.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableInterfaceBinding</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableInterfaceBinding</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="addkeyvaluestore">
<h3><code class="docutils literal notranslate"><span class="pre">addKeyValueStore</span></code><a class="headerlink" href="#addkeyvaluestore" title="Link to this heading">¶</a></h3>
<p>Implementations of a public KeyValueStore interface may be added in their respective languages and
made available to the library. General usage is supported, but typical future usage will be in
support of HTTP and endpoint property caching.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addKeyValueStore</span><span class="p">(</span><span class="s2">&quot;io.envoyproxy.envoymobile.MyKeyValueStore&quot;</span><span class="p">,</span> <span class="n">MyKeyValueStoreImpl</span><span class="p">())</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="o">//</span> <span class="n">Coming</span> <span class="n">soon</span><span class="o">.</span>
</pre></div>
</div>
<p>The library also contains a simple Android-specific KeyValueStore implementation based on Android’s
SharedPreferences.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Android</span>
<span class="n">val</span> <span class="n">preferences</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">getSharedPreferences</span><span class="p">(</span><span class="s2">&quot;io.envoyproxy.envoymobile.MyPreferences&quot;</span><span class="p">,</span> <span class="n">Context</span><span class="o">.</span><span class="n">MODE_PRIVATE</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">addKeyValueStore</span><span class="p">(</span><span class="s2">&quot;io.envoyproxy.envoymobile.MyKeyValueStore&quot;</span><span class="p">,</span> <span class="n">SharedPreferencesStore</span><span class="p">(</span><span class="n">preferences</span><span class="p">))</span>

<span class="o">//</span> <span class="n">iOS</span>
<span class="o">//</span> <span class="n">Coming</span> <span class="n">soon</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="forceipv6">
<h3><code class="docutils literal notranslate"><span class="pre">forceIPv6</span></code><a class="headerlink" href="#forceipv6" title="Link to this heading">¶</a></h3>
<p>Specify whether to remap IPv4 addresses to the IPv6 space and always force connections
to use IPv6. Note this is an experimental option and should be enabled with caution.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="o">//</span> <span class="n">No</span> <span class="n">API</span><span class="p">:</span> <span class="n">always</span> <span class="n">enabled</span>
<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">forceIPv6</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enableplatformcertificatesvalidation">
<h3><code class="docutils literal notranslate"><span class="pre">enablePlatformCertificatesValidation</span></code><a class="headerlink" href="#enableplatformcertificatesvalidation" title="Link to this heading">¶</a></h3>
<p>Specify whether to use platform provided certificate validation interfaces. Currently only supported on Android. Defaults to false.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enablePlatformCertificatesValidation</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enableproxying">
<h3><code class="docutils literal notranslate"><span class="pre">enableProxying</span></code><a class="headerlink" href="#enableproxying" title="Link to this heading">¶</a></h3>
<p>Specify whether to respect system Proxy settings when establishing connections.
Available on Android only.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableProxying</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="enablednscache">
<h3><code class="docutils literal notranslate"><span class="pre">enableDNSCache</span></code><a class="headerlink" href="#enablednscache" title="Link to this heading">¶</a></h3>
<p>Specify whether to enable DNS cache. Note that DNS cache requires an addition of
a key value store named ‘reserved.platform_store’.</p>
<p>The interval at which results are saved to the key value store defaults to 1s
but can also be set explicitly.</p>
<p>A maximum of 100 entries will be stored.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableDNSCache</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">saveInterval</span><span class="p">:</span> <span class="mi">60</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">enableDNSCache</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">saveInterval</span><span class="p">:</span> <span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setruntimeguard">
<h3><code class="docutils literal notranslate"><span class="pre">setRuntimeGuard</span></code><a class="headerlink" href="#setruntimeguard" title="Link to this heading">¶</a></h3>
<p>Adds a runtime guard key value pair to envoy configuration.  The guard is of the short form “feature”
rather than the fully qualified “envoy.reloadable_features.feature”
Note that Envoy will fail to start up in debug mode if an unknown guard is specified.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setRuntimeGuard</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setRuntimeGuard</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setxds">
<h3><code class="docutils literal notranslate"><span class="pre">setXds</span></code><a class="headerlink" href="#setxds" title="Link to this heading">¶</a></h3>
<p>Sets the Bootstrap configuration up with <a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/xds_api#config-overview-ads">xDS</a>
to fetch dynamic configuration from an xDS management server. The xDS management server must
support the ADS protocol. At this moment, only the State-of-the-World (SotW) xDS protocol is
supported, not the Delta protocol. The Envoy Mobile client will communicate with the configured
xDS management server over gRPC.</p>
<p>Use the XdsBuilder class to configure the xDS for the Envoy Mobile engine.  For example, the
<cite>addRuntimeDiscoveryService()</cite> method can be used to configure the
<a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/service/runtime/v3/rtds.proto">Runtime Discovery Service (RTDS)</a>
and the <cite>addClusterDiscoveryService()</cite> method to configure the
<a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cds">Cluster Discovery Service (CDS)</a>.</p>
<p>Parameters:
xds_builder</p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">val</span> <span class="n">xdsBuilder</span> <span class="o">=</span> <span class="n">new</span> <span class="n">XdsBuilder</span><span class="p">(</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;my_xds_server.com&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">443</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">addRuntimeDiscoveryService</span><span class="p">(</span><span class="s2">&quot;my_rtds_resource&quot;</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">addClusterDiscoveryService</span><span class="p">()</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setXds</span><span class="p">(</span><span class="n">xdsBuilder</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">var</span> <span class="n">xdsBuilder</span> <span class="o">=</span> <span class="n">XdsBuilder</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="s2">&quot;my_xds_server.com&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="mi">443</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">addRuntimeDiscoveryService</span><span class="p">(</span><span class="s2">&quot;my_rtds_resource&quot;</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">addClusterDiscoveryService</span><span class="p">()</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setXds</span><span class="p">(</span><span class="n">xdsBuilder</span><span class="p">)</span>

<span class="o">//</span> <span class="n">C</span><span class="o">++</span>
<span class="n">XdsBuilder</span> <span class="n">xds_builder</span><span class="p">(</span><span class="o">/*</span><span class="n">address</span><span class="o">=*/</span><span class="s2">&quot;my_xds_server.com&quot;</span><span class="p">,</span> <span class="o">/*</span><span class="n">port</span><span class="o">=*/</span><span class="mi">443</span><span class="p">);</span>
<span class="n">xds_builder</span><span class="o">.</span><span class="n">addRuntimeDiscoveryService</span><span class="p">(</span><span class="s2">&quot;my_rtds_resource&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">addClusterDiscoveryService</span><span class="p">();</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setXds</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">move</span><span class="p">(</span><span class="n">xds_builder</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="setnodeid">
<h3><code class="docutils literal notranslate"><span class="pre">setNodeId</span></code><a class="headerlink" href="#setnodeid" title="Link to this heading">¶</a></h3>
<p>Sets the node.id field. See the following link for details:
<a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-node">https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-node</a></p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNodeId</span><span class="p">(</span><span class="n">nodeId</span> <span class="o">=</span> <span class="s2">&quot;my_test_node&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNodeID</span><span class="p">(</span><span class="s2">&quot;my_test_node&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">C</span><span class="o">++</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNodeId</span><span class="p">(</span><span class="s2">&quot;my_test_node&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setnodelocality">
<h3><code class="docutils literal notranslate"><span class="pre">setNodeLocality</span></code><a class="headerlink" href="#setnodelocality" title="Link to this heading">¶</a></h3>
<p>Sets the node.locality field. See the following link for details:
<a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-node">https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-node</a></p>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Kotlin</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNodeLocality</span><span class="p">(</span><span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;us-west-1&quot;</span><span class="p">,</span> <span class="n">zone</span> <span class="o">=</span> <span class="s2">&quot;some_zone&quot;</span><span class="p">,</span> <span class="n">subZone</span> <span class="o">=</span> <span class="s2">&quot;some_sub_zone&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Swift</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNodeLocality</span><span class="p">(</span><span class="n">region</span><span class="p">:</span> <span class="s2">&quot;us-west-1&quot;</span><span class="p">,</span> <span class="n">zone</span><span class="p">:</span> <span class="s2">&quot;some_zone&quot;</span><span class="p">,</span> <span class="n">subZone</span><span class="p">:</span> <span class="s2">&quot;some_sub_zone&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">C</span><span class="o">++</span>
<span class="n">builder</span><span class="o">.</span><span class="n">setNodeLocality</span><span class="p">(</span><span class="s2">&quot;us-west-1&quot;</span><span class="p">,</span> <span class="s2">&quot;some_zone&quot;</span><span class="p">,</span> <span class="s2">&quot;some_sub_zone&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-configuration">
<h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Link to this heading">¶</a></h2>
<p>In most cases, the functions provided by the builder should cover basic setup requirements.
However, in some cases it can be useful to provide a
<a class="reference external" href="https://www.envoyproxy.io/docs/envoy/latest/configuration/configuration">Envoy configuration YAML file</a>
with additional customizations applied.</p>
<p>This may be done by initializing a builder with the contents of the YAML file you you wish to use:</p>
<p><strong>Kotlin example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">streamClient</span> <span class="o">=</span> <span class="n">AndroidEngineBuilder</span><span class="p">(</span><span class="n">baseContext</span><span class="p">,</span> <span class="n">Yaml</span><span class="p">(</span><span class="n">yamlFileString</span><span class="p">))</span>
  <span class="o">.</span><span class="n">addLogLevel</span><span class="p">(</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">WARN</span><span class="p">)</span>
  <span class="o">.</span><span class="n">addStatsFlushSeconds</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="o">.</span><span class="n">build</span><span class="p">()</span>
  <span class="o">.</span><span class="n">streamClient</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Swift example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">streamClient</span> <span class="o">=</span> <span class="k">try</span> <span class="n">EngineBuilder</span><span class="p">(</span><span class="n">yaml</span><span class="p">:</span> <span class="n">yamlFileString</span><span class="p">)</span>
  <span class="o">.</span><span class="n">addLogLevel</span><span class="p">(</span><span class="o">.</span><span class="n">warn</span><span class="p">)</span>
  <span class="o">.</span><span class="n">addStatsFlushSeconds</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="o">.</span><span class="n">build</span><span class="p">()</span>
  <span class="o">.</span><span class="n">streamClient</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Using custom YAML configurations can lead to runtime bugs or crashes due to the fact that the
configuration string is not evaluated until runtime, and not all of the core Envoy configuration
options are supported by Envoy Mobile.</p>
</div>
</section>
<section id="making-requests">
<h2>Making requests<a class="headerlink" href="#making-requests" title="Link to this heading">¶</a></h2>
<p>Now that you have a stream client instance, you can start making requests:</p>
<ul class="simple">
<li><p><a class="reference internal" href="http.html#api-http"><span class="std std-ref">HTTP requests and streams</span></a></p></li>
<li><p><a class="reference internal" href="grpc.html#api-grpc"><span class="std std-ref">gRPC streams</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.html" class="btn btn-neutral float-left" title="API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="http.html" class="btn btn-neutral float-right" title="HTTP requests and streams" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 Lyft, Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>